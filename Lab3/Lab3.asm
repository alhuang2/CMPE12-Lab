;UCSC
;CMPE 12L-01D TA: Max Lichtenstein
;Lab 3: Decimal to Binary converter
;Alston Huang
;alyehuan@ucsc.edu
;Due Date:2/19/17

.ORIG 3000

LEA R0, WELCOME
PUTS

MAINLOOP LEA R0, ASK
PUTS
AND R0, R0, 0 ;SPECIAL REGISTER
AND R1, R1, 0 ;FLAG
AND R3, R3, 0 ;TEMP
AND R4, R4, 0 ;TEMP
AND R5, R5, 0 ;DIGIT THING
AND R6, R6, 0 ;TEMP
AND R7, R7, 0 ;TEMP

GRABR0 GETC
OUT

AND R3, R3, 0
AND R4, R4, 0
AND R6, R6, 0

;Check for X 
AND R3, R3, 0
ADD R3, R3, -16
ADD R3, R3, -16
ADD R3, R3, -16
ADD R3, R3, -16
ADD R3, R3, -16
ADD R3, R3, -8 ;R3 IS NOW -48
ADD R3, R3, R0 ;-48 + ASCII VALUE OF USER INPUT
BRz ENDPROGRAM

;CHECK FOR ENTER
CHECKLF AND R3, R3, 0 
ADD R3, R0, 0 ;R3 CONTAINS USER INPUT
ADD R4, R4, -10 ;R4 HOLDS -10
ADD R3, R4, R3 ;-10 + R3(USER INPUT)
BRz STARTPROGRAM

;CHECK FOR "-" SYMBOL
CHECKNEG AND R3, R3, 0
AND R4, R4, 0
ADD R3, R0, 0 ;STORE USER INPUT TO R3
ADD R4, R4, -16
ADD R4, R4, -16
ADD R4, R4, -13 ;R4 NOW CONTAINS ASCII VALUE OF "-"
ADD R4, R4, R3 ;-45 + R3(USER INPUT)
BRz CHANGEFLAG

;CONVERT TO DIGIT
TODIGIT AND R3, R3, 0
AND R4, R4, 0 
ADD R3, R3, R0 ;STROE USER INPUT TO R3
ADD R3, R3, -16
ADD R3, R3, -16
ADD R3, R3, -16 ;R3 IS NOW THE ACTUAL DECIMAL VALUE
ADD R4, R4, -9 ;SET COUNTER TO 9
AND R6, R6, 0 ;RESET TEMP
ADD R6, R6, R5 ;
MULTIPLY ADD R5, R6, R5 ;KEEP ADDING BY ITSELF UNTIL COUNTER=0
ADD R4, R4, 1
BRn MULTIPLY
ADD R5, R5, R3 ; +DIGIT PART
BRnzp GRABR0

FLIP NOT R5, R5 
ADD R5, R5, 1 ;TWO'S COMPLMENT
BRnzp STARTPROGRAM1

CHANGEFLAG AND R1, R1, 0
ADD R1, R1, 1
BRnzp GRABR0

;BEGIN OPERATIONS
STARTPROGRAM LEA R0, ASK
PUTS
ADD R1, R1, 0
BRp FLIP ;CHECK IF FLAG IS 1
STARTPROGRAM1 AND R4, R4, 0
AND R3, R3, 0
AND R6, R6, 0

MASKLOOP LEA R4, MASK ; MASK ADDRESSS/ POINTER VARIABLE
ADD R4, R4, R3 ; CHANGE POINTER BY R3
LDR R4, R4, 0 ;SET R4 TO CONTAIN THE MASK VALUE
AND R6, R6, 0 
AND R0, R0, 0
AND R6, R5, R4 ;MASK THE SUM AND MASKVALUE
BRz PRINTZERO
BRnp PRINTONE

CONTMASK ADD R3, R3, 1 
ADD R6, R3, -16
BRn MASKLOOP
BRzp MAINLOOP

PRINTZERO AND R0, R0, 0
LEA R0, ZERO
PUTS
BRnzp CONTMASK

PRINTONE AND R0, R0, 0
LEA R0, ONE
PUTS
BRnzp CONTMASK

ENDPROGRAM HALT
WELCOME .STRINGZ "Welcome to the Decimal/Binary converter."
ASK .STRINGZ "\nEnter a decimal number or press X to quit.\n"
RESPONSE .STRINGZ "Thanks, here it is in binary\n"
ONE .STRINGZ "1"
ZERO .STRINGZ "0"

MASK .FILL x8000
.FILL x4000
.FILL x2000
.FILL x1000
.FILL x0800
.FILL x0400
.FILL x0200
.FILL x0100
.FILL x0080
.FILL x0040
.FILL x0020
.FILL x0010
.FILL x0008
.FILL x0004
.FILL x0002
.FILL x0001

.END

